(function(b,c,d){var a=function(f,e){this.$dom=c(f);this.options=c.extend({},a.defaults,e);this.attach();this.bind_events();b.setTimeout(this.$dom.trigger.bind(this.$dom,"change"),0)};a.prototype.bind_events=function(){this.$dom.on("change",this.rebuild.bind(this))};a.prototype.attach=function(){var f=this.$dropdown=c(this.options.template);this.$dom.attr("__dropdown-old-display",this.$dom.css("display")||"").css("display","none");this.$dom.after(f);var e=this;if(!this.options.hover){f.on("click",".dropdown-current",function(){e[f.is(".actived")?"collapse":"expand"].call(e,f[0])})}else{f.on("mouseenter",e.expand.bind(e,f[0])).on("mouseleave",e.collapse.bind(e,f[0]))}f.on("click",".dropdown-items > .dropdown-item > a",function(){e.switchTo(c(this).closest(".dropdown-item").attr("data-value"))})};a.prototype.detach=function(){this.$dom.css("display",this.$dom.attr("__dropdown-old-display"));$dropdown.remove()};a.prototype.build=a.prototype.rebuild=function(){this.$dropdown.find(".dropdown-items").empty();this.$dropdown.find(".dropdown-current").empty();var e=this;this.$dom.find("> * ").each(function(){var j=this;var i=j.tagName==="OPTGROUP";var h=e.options.build(j,j.selected,i);e.$dropdown.find(".dropdown-items").append(h);if(i){c(j).find("> * ").each(function(){var k=e.options.build(this,this.selected,false);e.$dropdown.find(".dropdown-items").append(k)})}});var g=this.$dom.find("option:selected");if(g.length<=0){return}var f=this.options.build_current(g[0]);this.$dropdown.find(".dropdown-current").replaceWith(f)};a.prototype.switchTo=function(g,e){var f=this.$dom.find('option[value="'+(g||"")+'"]');if(f.length>0){this.$dom.val(g||"").trigger("change")}else{this.$dom.find(g).attr("selected",true)}if(!e){this.collapse()}};["expand","collapse"].forEach(function(e){a.prototype[e]=function(f){return function(j){var h;if(Object.prototype.toString.call(j)==="[object Number]"){h=j;j=d}j=j||this.$dropdown[0];if(typeof this.__delay_timer!=="undefined"){b.clearTimeout(this.__delay_timer)}var g=this;if(f==="expand"&&this.options.mutexWith!==false){c(this.options.mutexWith).each(function(){console.log("is same : ",g.$dom.is(this));if(g.$dom.is(this)){return}var k=c(this).data("dropdownBox");if(typeof k==="undefined"||k===null){return}k.collapse()})}var i=function(){g.options[f].call(g.options[f],j,h);b.clearTimeout(g.__delay_timer);g.__delay_timer=d};if(typeof h==="undefined"){i()}else{this.__delay_timer=b.setTimeout(i,h)}}}(e)});a.prototype.remove=function(f){var e=this.$dom.find('option[value="'+(f||"")+'"]');if(e.length===0){e=this.$dom.find(f)}e.remove();this.$dom.trigger("change")};a.prototype.sort=function(f){var e=this.$dom.find("> * ");e.sort(function(h,g){if(h.tagName==="OPTGROUP"){c(h).find("> * ").sort(f).appendTo(h)}if(g.tagName==="OPTGROUP"){c(g).find("> * ").sort(f).appendTo(g)}return f(h,g)}).appendTo(this.$dom);this.rebuild()};a.defaults={hover:false,template:'<div class="dropdown"><a class="dropdown-current"></a><ul class="dropdown-items"></ul></div>',build_current:function(e){return'<a class="dropdown-current" href="javascript:;">'+(e.innerHTML||"")+"</a>"},build:function(g,e,f){if(!f){return'<li class="dropdown-item'+(e?" actived":"")+'" data-value="'+(g.value||"")+'"><a href="javascript:;">'+(g.innerHTML||"")+"</a></li>"}else{return'<li class="dropdown-group-item" >'+(g.getAttribute("label")||"")+"</li>"}},expand:function(e){c(e).addClass("actived")},collapse:function(e){c(e).removeClass("actived")},mutexWith:"select"};c.fn.dropdownBox=function(e,f){f=f||"dropdownBox";return c(this).each(function(){var g=c(this);var h;g.data(f,h=(g.data(f)||new a(this,e)))})};c.fn.dropdownBox.constructor=a})(window,window.jQuery||window.Zepto);